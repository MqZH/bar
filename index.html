<!DOCTYPE html>


<head>
  <meta charset="utf-8">
  <title> Bar chart </title>

   <!-- include the jQuery and jQuery UI scripts -->
   <script src="https://code.jquery.com/jquery-2.1.1.js"></script>
   <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
   <script src="./jquery-ui-slider-pips.js"></script>
                   
   <!-- plus a jQuery UI theme, here I use "flick" -->
   <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/flick/jquery-ui.css">
   <link rel="stylesheet" href="./jquery-ui-slider-pips.css">

  <link rel="stylesheet" href="d3.slider.css" />  


  <!-- <script type="text/javascript" src="jquery-3.3.1.min.js"></script> -->
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

  <style>
   /* COMMON RADIO AND CHECKBOX STYLES  */

   
    #slider2 {
    margin-top: 10px; 
    }
    #slider2 .ui-slider-pip {
        top: -8px; 
        color: #282828;
        font-size: 12px;
    }
    #slider2 .ui-slider-pip .ui-slider-label {
        top: -12px; 
    } 

    #slider4 {
    margin-top: 10px; 
    margin-bottom: 20px; 
    }
    #slider4 .ui-slider-pip {
        top: -8px; 
        color: #282828;
        font-size: 12px;
    }
    #slider4 .ui-slider-pip .ui-slider-label {
        top: -12px; 
    }

    body {
      font: 10px sans-serif;
      position: relative;
      text-align: center;
      /* left: 25%; */
    }
    .svg {margin-left: auto; margin-right:auto; display:block;}
    .axis path,
    .axis line {
      fill: none;
      stroke: #282828;
      shape-rendering: crispEdges;
    }
    .x.axis path {
      display: none;
    }
    .wrapper {
          width: 960px;
          margin-left: auto;
          margin-right: auto;
          border-style: groove;
        }
    .wrapper2 {
          width: 920px;
          border-top: 20px;
          margin-left: auto;
          margin-right: auto;
          border-style: groove;
        }
    .wrapper > div {
          margin-top: 0px;
          margin-bottom: 35px;
        }
    span.l{
    bottom: -23px;
    position: relative;
    left:-33%;
    }
    span.r{
    bottom: -23px;
    position:relative;
    left:32%;
    }

    span.l-2{
    /* bottom: 5px; */
    position:relative;
    left:-0.5%;
    }
    span.r-2{
    /* bottom: 5px; */
    position:relative;
    left:0%;
    }
  .slider{
      width: 600px;
      margin-left: auto;
          margin-right: auto;
      /* text-align: "center"; */
      /* left: 30px; */
  
    }
  .slider2{
    width: 800px;
    left: 50px;
  
    }
  .myButton {
    /* padding: 6px 12px; */
    width: 6.5em;
    height: 2.5em;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 4px;
    cursor: pointer;
}
.myInput{
  font-size : 18px;
}
.slider .ui-slider-handle {
  background : #888888
}

input[type=radio] {
    border: 0px;
    width: 1.8em;
    height: 1.8em;
}

.containerR > .label {
    font-size: 1.3em;
    border: 0px;
    margin-left:0;
    
}

.containerR > .containerR-1 {

    margin-left:55px;
    width: 1.8em;
    height: 1.8em;
}
.containerR > .containerR-0 {
    width: 1.8em;
    height: 1.8em;
    margin-left:0px;
}
.containerR  >  .label-2 {
  font-size: 1.3em;
    border: 0px;
    margin-left:0;
  margin-right:10px;
}
  </style>
</head>



<body>
    <br />
    <div class="wrapper" id = "intro" >
      <br />
      <div class="wrapper2" >
        <h1>Instructions</h1>  
        <h2>
          This test is aimed at assessing your ability of grasping a bar chart. 
          <br />
          <br />
           There will be 130 charts (tasks) including 10 training tasks and 120 testing tasks.
          <br />
          <br />
            We have 2 questions for each task. To answer these questions, please use the slider / Likert scale. 
          <br />
          <br />
           The questions for each task is the same.    
          <br />
          <br />
            There is no need to calculate the data precisely. The chart will be shown for 1 second. Please be quick.
          <br />
          <br />
            If you do not finish within this period, press "showChart" button to see it again. The time you spent will be recorded. 
          <br />
          <br />
            After finishing all the tasks, the "Submit" button will appear. Press it to submit your answers.
          <br />
          <br />
            Avoid skipping any task in the study. Chrome broswer is preferred.
        </h2>
      </div>

      <div class="wrapper2"  >
                
        <h1>
          Question 1</h1>
          <h2>How do you think about the height of the target bar highlighted in orange among the whole group? </h2>
        
        <br />
        <br />
        
        <h1>
          Question 2</h1>
        
        <h2>
          To what degree are you sure about your answer?</h2>
      </div>


      <div class="wrapper2"  >
        <h1>
          Press the "Next" button to start. 
          <input name="Next" 
          type="button"
          class = "myButton" 
          value="Next" 
          onclick="updateData()" />
        </h1>
      </div>
      

    </div>
  <br />
  <br />
  
 
    

    <div class="wrapper" style="visibility: hidden" id = "study">    
        
        <h2 id = "context1" > How do you think about the height of 
          the target bar highlighted in orange among the whole group? </h2>
            <br />
        <div>
          <span class="l" style="font-size: 1.5em;" id = "lTag">Shortest</span>
         
          <span class="r" style="font-size: 1.5em;" id = "rTag">Tallest</span>
          <div class = "slider" id="slider4"></div> 
          
        </div>
        
        
        <div>
          <h2 id = "context2"> To what degree are you sure about your answer?  </h2>
          <span class="l-2" style="font-size: 1.5em;" >Unsure</span>


          <span class = "containerR">
              <input type="radio" class = "containerR-0"  name="bedStatus" id="1" value="1"/>
                <label class = "label" for="1">1</label>

              <input type="radio"  class = "containerR-1" name="bedStatus" id="2" value="2"/>
                <label class = "label" for="2">2</label>

              <input type="radio" class = "containerR-1" name="bedStatus" id="3" value="3"/>
                <label class = "label" for="3">3</label>
 
              <input type="radio"  class = "containerR-1" name="bedStatus" id="4" value="4"/>
                <label class = "label" for="4">4</label>
        
              <input type="radio" class = "containerR-1" name="bedStatus" id="5" value="5"/>
                <label class = "label" for="5">5</label>
      
              <input type="radio"  class = "containerR-1" name="bedStatus" id="6" value="6"/>
                <label class = "label" for="6">6</label>
         
              <input type="radio" class = "containerR-1" name="bedStatus" id="7" value="7"/>
                <label class = "label-2" for="7">7</label>
     
          </span>
          <span class="r-2" style="font-size: 1.5em;" >Sure</span>
        </div>

        <div>
            <span  style="text-align:center;">
                <input name="updateButton" 
                       type="button" 
                       class = "myButton"
                       value="Previous" 
                       onclick="prevData()" />
            </span>
            <span class = "myInput"> index: <input type="text"  id="myText" value="0" class = "myInput"/></span>
            <span  style="text-align:center;">
                <input name="showChart" 
                      type="button"
                      class = "myButton" 
                      value="showChart" 
                      onclick="renderChart()" /> 
            </span>
            <span style="text-align:center;">
              <input name="updateButton" 
                     type="button"
                     class = "myButton" 
                     value="Next" 
                     onclick="updateData()" /> 
            </span>  
            <span id="submit" style="text-align:center; visibility: hidden; display:none">
              <input name="submit" 
                      type="button" 
                      class = "myButton" 
                      value="submit" 
                      onclick="submit()" />
            </span>
        </div>
     
    </div>
    
    
    

    <svg style="visibility: hidden" id = "mainSvg"> 
    </svg>
 

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="d3.slider.js"></script>
    
    
    <script>
        var userId = Math.floor(Math.random() * 10000000);
        console.log(userId);
  
        var question2 = 0;
            $(document).ready(function() {
                $('input[type=radio][name=bedStatus]').change(function() {
                  //
                    if (this.value == '1') {
                      question2 = 1;
                    }
                    else if (this.value == '2') {
                      question2 =  2;
                    }
                    else if (this.value == '3') {
                      question2 =  3;
                    }
                    else if (this.value == '4') {
                      question2 =  4;
                    }
                    else if (this.value == '5') {
                      question2 =  5;
                    }
                    else if (this.value == '6') {
                      question2 =  6;
                    }
                    else if (this.value == '7') {
                      question2 =  7;
                    }
                // console.log(question2)
                });
            });
      var tickmark = 13;
      $("#slider4").each(function(i, e) {$(e)
                .slider({
                    max: tickmark,
                    min: 1,

                    orientation: "horizontal",
                    slide: function(event, ui) {
                        ui.handle.style.display = 'block';
                    }
                })
                .slider("pips", {
                  first: "pip",
                  last: "pip"
                })

            });

      $( "#slider4" ).css('background', '#DCDCDC');

    </script>


<script>
var timeCount = 0;
var a = new Date();
var timer = 0;

var margin = {top: 40, right: 20, bottom:60, left: 40},
    width = 960 - margin.left - margin.right,
    width2 = 360 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// bar 30: 960 500 {top: 40, right: 20, bottom: 30, left: 40},
// bar 10: 360 500 {top: 40, right: 20, bottom: 30, left: 40},
var formatPercent = d3.format(''); //".0%"


var x = d3.scale.ordinal()
   .rangeRoundBands([0, width], 0.5);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");
    

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(0)
    ////// bar 30 tick(2)
    .tickFormat(formatPercent);


svg = d3.select("#mainSvg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    // 
    .attr("transform", "translate(" + (margin.left) + "," + (margin.top  ) + ")");


d3.select("body");     
var Data = [];

var evaluationValues = new Array(12);
for(var i = 0; i < evaluationValues.length; i++){
	evaluationValues[i] = -1;
}
var certainty = new Array(12);
for(var i = 0; i < certainty.length; i++){
  certainty[i] = -1;
}
// var time = new Array(12);
// for(var i = 0; i < time.length; i++){
// 	time[i] = -1;
// }
var timeCounts = new Array(12);
for(var i = 0; i < timeCounts.length; i++){
	timeCounts[i] = -1;
}


d3.json("output11.json", function(error, data) {
  if (error) throw error;
  Data = data;
  var input = data['0']["dataSource"];
  render(input);
  
});

function render(input){
  if(input.length == 11){
    var x = d3.scale.ordinal()
      .rangeRoundBands([0, width2], 0.5);
    var xAxis = d3.svg.axis()
      .scale(x)   
      .orient("bottom");
    x.domain(input.map(function(d) { return  d.name; }));
  }
  else{
    var x = d3.scale.ordinal()
      .rangeRoundBands([0, width], 0.5);
    var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom");
    x.domain(input.map(function(d) { return  d.name; }));
  }

  
  // x.domain(input.map(function(d) { return  d.name; }));
  y.domain([0, d3.max(input, function(d) { return d.frequency; })]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
      .selectAll("text")
      // .attr("y", 0)
      // .attr("x", 9)
      .attr("dy", ".35em")
      .attr("transform", "rotate(45)")
      .style("text-anchor", "start");

  
  svg.selectAll(".bar")
      .data(input)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.name); })
      .attr("width", x.rangeBand()) // for 30 +3 "7.6mm"  "7.5mm"
      .attr("y", function(d) {  return y(d.frequency); })
      .attr("height", function(d) { return height - y(d.frequency); })
 
      .style("fill", function (d) { 
        if (d.ifTarget == 0) {return "steelblue" }
        else {return "orange"}
         });
}

function type(d) {
  d.frequency = +d.frequency;
  return d;
}
var i = 0


function updateData() {
  window.clearTimeout(timer);
  $("#intro").remove();
  document.getElementById("study").style.visibility = 'visible';
  
  evaluationValues[i] = $("#slider4").slider('value');
  certainty[i] = question2;
  timeCounts[i] = timeCount;
  timeCount = 0;
  question2 = 0;
  
  if(i == 9){
    document.getElementById("submit").style.display = 'block';
		alert('This is the last one. Please submit.');
  }
  
  else {
    
    if(i == 8){
    document.getElementById("submit").style.visibility = 'visible';
    document.getElementById("submit").style.display = 'block';
	  }

    d3.selectAll(".bar").remove();
    d3.selectAll(".axis").remove();

    i = i + 1;
    document.getElementById("myText").value = i;
    render(Data[i]['dataSource']);
    $("#mainSvg").show();
    document.getElementById("mainSvg").style.visibility = 'visible';
    timer = window.setTimeout(function() { document.getElementById("mainSvg").style.visibility = 'hidden';}, 1000);

    tickmark = Data[i]['barScale'];
    console.log(tickmark);
    console.log(Data[i]['dataSource'].length);
    $("#slider4")
      .slider({ 
        value: 0,
        max: tickmark
      })
      .slider("pips", {
        first: "pip",
        last: "pip"
      });
    var element = document.querySelector("#slider4 .ui-slider-handle");
    element.style.display = 'none';
    $('input[name=bedStatus]').attr('checked',false);
  }
    console.log(evaluationValues);
    console.log(certainty);
    // console.log(time)
    console.log(timeCounts);
}


function prevData() {
  // window.clearTimeout(timer)
  // var b = new Date();
  // var difference = (b - a) / 1000;
  // time[i-1] = difference;
  // a = b
  // evaluationValues[i] = $("#slider4").slider('value')
  // certainty[i] = question2;
  // timeCounts[i] = timeCount;
  timeCount = 0;
  question2 = 0;

  $(".wrapper").show();
  document.getElementById("submit").style.visibility = 'hidden';
  document.getElementById("submit").style.display = 'none';
	if(i == 1){
		alert('No test in front of 1!');
		i = i + 1;
	}
  d3.selectAll(".bar").remove();
  d3.selectAll(".axis").remove();

  i = i - 1;
  $("#slider4")
      .slider({ value: 0 })
      .slider("pips", {
        first: "pip",
        last: "pip"
      });
  var element = document.querySelector("#slider4 .ui-slider-handle");
  element.style.display = 'none';
  $('input[name=bedStatus]').attr('checked',false);


  document.getElementById("myText").value = i;
  render(Data[i]['dataSource']);
  $("#mainSvg").show();
  document.getElementById("mainSvg").style.visibility = 'visible';
  timer = window.setTimeout(function() { document.getElementById("mainSvg").style.visibility = 'hidden';}, 1000);

  console.log(evaluationValues);
  console.log(certainty);
  // console.log(time)
  console.log(timeCounts)
  
}



function submit(){
  // var b = new Date();
  // var difference = (b - a) / 1000;
  // time[8] = difference;

  evaluationValues[i] = $("#slider4").slider('value');
  certainty[i] = question2;
  timeCounts[i] = timeCount;
  if(i != 9){
    alert('Please submit after you finish all tests.');
  }
  else{
    var data = {};
    data['userId'] = userId;
    data['evaluationValues'] = evaluationValues;
    data['certainty'] = certainty;
    data['timeCount'] = timeCounts;
    console.log(data);
      $.ajax({
        url:"http://143.89.76.21/study0409/saveSubmit.php",
        type: 'POST',
        data: {'data': JSON.stringify(data)},
        success: function (msg) {
          alert(msg)
        }
      })
    }
      
	}

function renderChart(){
  window.clearTimeout(timer);
  document.getElementById("mainSvg").style.visibility = 'visible';
  // d3.selectAll(".bar").remove();
  // d3.selectAll(".axis").remove();
  // render(Data[i]['dataSource'])
  // $("#mainSvg").show();
  timer = window.setTimeout(function() {  document.getElementById("mainSvg").style.visibility = 'hidden';}, 1000);   
  // $("#mainSvg").hide(); 
  timeCount += 1;
}


function isInteger(number){
	var reg=/^[1-9]\d*$|^0$/;
	return reg.test(number);
}

</script>

</html>
